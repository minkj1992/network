# [CH06-1] IP 프로토콜 구조
> 멀리 있는 컴퓨터끼리는 이렇게 데이터를 주고받는다.

## IPv4 프로토콜
- IPv4가 하는 일
	- 네트워크 상에서 데이터를 교환하기 위한 프로토콜
	- 데이터가 **정확하게 전달될 것을 보장하지 않는다.**
		- 중복된 패킷 전달
		- 패킷의 순서를 잘못 전달할 가능성
		- Dos 공격
	- 데이터의 정확, 순차적 전달은 4계층의 `TCP`에서 보장한다.
- IPv4 프로토콜의 구조 (`20bytes` + Option(MAX 40)
	- `Version`
		- `4`(16진수 하나, 4bit)
	- `IHL`(IPv4 Header Length)
		- 20 ~ 60을 4로 나눈 값 사용
		- 일반적으로 (20bytes) `5`라고 작성된다.
		- 옵션이 하나 붙을 때마다 +1
	- TOS (Type of Service)
		- 예전에 사용했었는데, 지금은 비워짐
		- 1bytes 차지 -> `00`
	- `Identification`
		- 원래 하나인 데이터가 최대 전송량을 넘길 시에는 `조각화`가 필요하다
		- 조각된 데이터 패킷을 읽어들일 때는 조각들이 자신에게 맞는 그룹으로 갈 수 있도록 분류기준이 필요하다.
		- 그러므로 조각화가 일어난다면 조각된 데이터들을 같은 id를 주어서 패킷 전송을한다.
		- 통신은 순서를 보장하지 않으므로 나중에 보낸 패킷의 조각이 먼저 보낸 패킷의 조각 데이터들 사이에 끼어있을 수 있다. (CCCCDCCCCC) 이럴 경우 D를 버린다.
		- 통신상에서 중복된 패킷이 오는 것 방지 (C패킷 전송 완료 이후 다시 C 패킷 조각들이 올경우)
	- `IP Flags`
		- 3bit ( x D M) 
			- x는 안쓴다는 뜻
			- Don't fragment
				- 패킷이 최대 전송단위보다 큰 것을 줄 경우, 전송이 안됨
				- 거의 안씀
			- More fragment
				- 조각화가 일어났을때, 나 뒤에 아직 조각이 더 남았다라고 알려줌 (001)
	- `Fragment Offset` (13bit)
		- 조각 데이터 복구 시 데이터 순서 정렬용
		- offset : 어느 기준으로부터 얼마정도 떨어져있다.
		- 패킷 처음 부터 현재 조각이 얼마만큼 떨어져 있는지를 알려줌
	- `TTL`(Time To Live) (1bytes)
		- 잘못 전달된 패킷이 네트워크 세상에서 계속 떠돌아 다니면 안된다.
		- count를 활용해서 목숨 
		- window 128, linux 64
	- `Protocol` (1bytes)
		- 상위 프로토콜(4계층) 종류 알려줌
			- tcp
			- udp
	- `Header Checksum`
		- 헤더가 잘 전달되었는지를 체크해준다.
	- `출발 IP` (4bytes)
	- `목적지 IP` (4bytes)
## ICMP
- ICMP가 하는 일
	- Internet Control Message Protocol, 인터넷 제어 메시지 프로토콜
	- 네트워크 컴퓨터 위에서 돌아가는 운영체제에서 **오류메시지**를 전송 받는 데 주로 쓰인다.
	- 대표적으로 `상대방과 전송이 되나 안되나 확인하는 프로토콜` 용도로 사용
- ICMP 프로토콜의 구조
	- TYPE(대분류) + CODE(소분류) + CHECKSUM
	- `Type`
		- `0`(요청)
		- `8`(응답)
		- `3`(Destination Unreachable)
		- `11`(요청시간 만료) : 대체로 상대방이 방화벽
		- `5` (ICMP redirect)
			- 예전에 쓰던것
			- routing table 수정용
			- 보안상 요새 잘 안씀
## 라우팅 테이블
- 내가 보낸 패킷은 어디로 가는가?



## 다른 네트워크와 통신 과정
- 다른 네트워크까지 내 패킷의 이동 과정

## IPv4의 조각화

## 실습
- 라우팅 테이블 확인해보기
- 패킷 분석하기

