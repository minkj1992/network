
# [CH06-2] 조각화

## `IPv4`의 조각화
- 조각화:  전송되는 `IP 패킷`들이 `MTU`를 가지는 링크를 통하여 전송되기 위해서는 여러 개의 작은 패킷으로 조각화 되어 전송된다. 
- 목적지까지 패킷을 전달하는 과정에 통과하는 각 라우터마다 전송에 적합한 프레임으로 변환이 필요
- 일단 조각화 되면 최종 목적지에 도달하기 전까지 재조립되지 않는 것이 일반적
- `IPv4`에서는 발신지 뿐 아니라 중간 라우터에서도 IP 조각화 가능
- 재조립은 최종 수신지에서

- 페이로드 계산법
	- MTU 크기 - IPv4프로토콜 헤더(`20`Bytes)  >= `전송 페이로드 크기`
- Fragment 구조 (조각화된 패킷)
	- IPv4 헤더 + Data
		- Ipv4 = MF(More Fragment), Offset
			- MF는 1로 나오다가 마지막 조각에서 0으로 세팅
			- Offset은 `최대 전송 페이로드크기` / 8 단위로 증가
			- **각 조각들의 IPv4 ID는 같으며, 이를 통하여 최종 수신지에서 재조립이 가능하다.**

## 예제
> 네이버에 `Ping` 명령어를 보낼때 현상

내가 보내고자 하는 Data의 실제 크기가 `2000Bytes`이고 `MTU`가 `1500Bytes`라고 한다면 
1. (a) 2008 = `ICMP`(8) + `Data`(2000)
2. (b) 2028 = `IPv4`(20) + (a)
3. 데이터 조각화가 필요
4. 조각화 실행
 5. Data (1480, 520)
 6. ICMP는 마지막 조각에만 붙으며, IPv4는 각 조각들에 붙는다 ( 1480+20 = `1500`, 520+20+8= `548`)
 7. 이더넷 프로토콜(`14`)이 각 조각들에 붙는다. (1514, 562)
 8. 전송
**IPv4가 붙고 MTU 검사하고 이더넷(14)가 추가로 붙는다 **  

## 예제 2
```
보내려는 데이터: 2379
MTU			: 980
```
1. 몇개의 패킷으로 쪼개지는가? 960, 960, 459 (3개)
2. 첫번째 패킷의 데이터 크기는 몇인가? 960
3. 마지막 패킷의 데이터 크기는 몇인가? 459
4. offset의 단위는? : 120

`ping xxx.xxx.x.xx -l 4800`: 해당 IP에 4800 데이터 크기 단위로 보내라 