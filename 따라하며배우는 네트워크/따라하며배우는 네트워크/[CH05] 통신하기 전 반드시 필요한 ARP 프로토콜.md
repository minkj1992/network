# [CH05] 통신하기 전 반드시 필요한 `ARP` 프로토콜

## ARP 프로토콜
> IP주소를 이용해 MAC주소를 알아오는 프로토콜
- `ARP`가 하는 일
	- ARP 프로토콜은 같은 네트워크 대역에서 통신을 하기 위해 필요한 `MAC주소`와 `IP주소`를 이용해서 알아오는 프로토콜이다.
	- 같은 네트워크 대역에서 통신을 한다고 하더라도 데이터를 보내기 위해서는 `7계층`부터 `캡슐화`를 통해 데이터를 보내기 때문에 `IP`와 `MAC`주소가 모두 필요하다.
	- 이때 **`IP`는 알고 `MAC`주소는 모르더라도 ARP를 통하면 가능하다.**
- C.F) 이더넷 프로토콜은 60bytes ~ 최대단위
## `ARP` 프로토콜의 구조
> 28Bytes

- 참고로 이더넷 프로토콜만 목적지가 먼저옴 (다른 모든 것들은 출발지 먼저)
- 구조
	- 타입
		- 2계층 타입
			- 0001 (이더넷)
		- 3계층 타입
			- 0800 (IPv4)
	- 길이
		- 2계층 길이
			- 6bytes ---> 06
		- 3계층 길이
			- 4bytes ---> 04
	- `Opcode`
		- operation code
		- 요청 / 응답 (ip로 요청 / Mac값 응답)
		-    1   /  2
		-  0001 / 0002
	- 출발지
		- MAC주소 (6bytes)
		- IP 주소 (4bytes)
	- 도착지
		- MAC 주소(6)
		- IP (4)
- `0001 0800 0604 0001/0002`
	- 이더넷 ip 6bytes 4bytes 요청/응답
- `ARP`
## ARP 프로토콜의 통신과정
- `IP주소`로 `MAC주소` 알아오는 과정
1. 이더넷(2) + ARP(3)으로 패킷을 만든다.
2. ARP는 0001 0800 0604 0001 내mac주소 + 내 IP주소 + 00 00 00 00 00 00 (상대방 mac) + 상대방 ip
3. ARP에서 이더넷으로 `캡슐화`할때 기본적으로 ARP 상대방 MAC주소가 `00 00 00 00 00 00`이라면  `FF FF FF FF FF FF`라고 이더넷 MAC 목적지에 작성한다.
4. `FF FF FF FF FF FF` 라면 2진수로 쳤을땐 1로 꽉채운 것이다. 
	- IP에서 뒤에부분을 전부다 1로 꽉채우면 `BROADCAST`
	- MAC주소도 마찬가지
5. 스위칭(2계층)을 거쳐 모든 연결된 HW에 `broadcasting`해준다. (`2계층 디캡슐`)
6. 각 컴퓨터에 패킷이 브로드캐스팅되어 전달��다면 `3계층 디캡슐`
7. 만약 목적지 ip와 자기 ip가 다르다면 패킷을 버린다.
8. 일치하는 컴퓨터에서는 다시  응답 프로토콜(Opcode = 0002, mac주소 채우기)을 만들어서 `스위치`에 전달
9.  출발지에서 ARP을 디캡슐하여 MAC주소를 `ARP CACHE TABLE`에 상대방 MAC주소 등록한다.
## ARP 테이블
- 나와 통신했던 컴퓨터들
	- arp는 기본적으로 cache
	- `IP`: `MAC`를 key, value를 가진 lookup 테이블
## 실습
- ARP 테이블 확인
	- `arp -a`
- ARP 프로토콜 분석하기